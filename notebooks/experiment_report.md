# PINN 1D波動方程式実験レポート

**実施日**: 2026年1月7日
**実験者**: AI Assistant
**目的**: 様々な設定でPINNモデルを訓練し、性能と精度を比較する

---

## 1. 実験概要

本実験では、Physics-Informed Neural Network (PINN) を用いて1D波動方程式を解く際の、異なる設定における性能を評価しました。

### 波動方程式

$$\frac{\partial^2 u}{\partial t^2} = c^2 \frac{\partial^2 u}{\partial x^2}$$

### 実験環境

- **フレームワーク**: DeepXDE
- **GPU**: NVIDIA GeForce RTX 3060
- **Python**: 3.12
- **PyTorch**: 2.4.0+cu124

---

## 2. 実験設定

以下の5つの実験を実施しました：

### 実験1: Standing Wave (Dirichlet BC) - 8000エポック
- **設定ファイル**: `standing_wave_example.yaml`
- **境界条件**: Dirichlet (固定端)
- **解析解**: $u(x,t) = \sin(n\pi x/L) \cos(n\pi ct/L)$
- **ネットワーク構造**: [2, 50, 50, 50, 1]
- **損失ウェイト**: {data: 1.0, pde: 1.0, bc: 10.0, ic: 10.0}

### 実験2: Neumann BC - 8000エポック
- **設定ファイル**: `neumann_bc_example.yaml`
- **境界条件**: Neumann (自由端)
- **解析解**: $u(x,t) = \cos(n\pi x/L) \cos(n\pi ct/L)$
- **ネットワーク構造**: [2, 64, 64, 64, 64, 1]
- **損失ウェイト**: {data: 1.0, pde: 1.0, bc: 5.0, ic: 500.0}

### 実験3: Traveling Wave - 8000エポック
- **設定ファイル**: `traveling_wave_example.yaml`
- **境界条件**: Neumann
- **解析解**: d'Alembert解 (ガウシアンパルス)
- **ネットワーク構造**: [2, 64, 64, 64, 1]
- **損失ウェイト**: {data: 0.5, pde: 2.0, bc: 5.0}

### 実験4: Standing Wave - 4000エポック
- **設定**: 実験1と同じ（エポック数のみ変更）
- **目的**: エポック数削減の影響を評価

### 実験5: Standing Wave - 12000エポック
- **設定**: 実験1と同じ（エポック数のみ変更）
- **目的**: エポック数増加の影響を評価

---

## 3. 実験結果

### 3.1 定量的評価

| 実験 | エポック数 | 訓練時間(秒) | L2誤差 | 相対誤差(%) | 最大誤差 | 検証結果 |
|-----|----------|------------|--------|------------|---------|---------|
| Standing Wave (Dirichlet) | 8000 | 53.48 | 0.9217 | 7.56 | 0.0908 | **FAILED** |
| Neumann BC | 8000 | 81.70 | 1.3157 | 10.69 | 0.1461 | **FAILED** |
| Traveling Wave | 8000 | 65.98 | N/A | N/A | N/A | 検証無効 |
| Standing Wave | 4000 | 27.85 | 0.6628 | **5.44** | 0.0642 | **FAILED** |
| Standing Wave | 12000 | 83.27 | 1.0184 | 8.36 | 0.0972 | **FAILED** |

**注**: 検証合格基準は相対誤差 < 5%

### 3.2 損失の収束

#### 実験3 (Traveling Wave) の訓練損失曲線

![Training Curves - Traveling Wave](/home/manat/project3/PINN/experiments/traveling_wave_dalembert_2026-01-07_12-37-55/training_curves.png)

**観察結果**:
- 最初の10エポック以内で急速に損失が減少
- Total Lossは約0.1で安定
- PDE損失、データ損失、境界条件損失すべてが効果的に最小化されている

---

## 4. 解の比較

### 4.1 Standing Wave (Dirichlet BC) - 8000エポック

![Standing Wave 8000](/home/manat/project3/PINN/experiments/standing_wave_fundamental_mode_2026-01-07_12-35-32/solution_comparison.png)

**観察結果**:
- t=0, t=0.75, t=1.0 では解析解とPINN予測がよく一致
- t=0.25, t=0.5 で振幅の位相ずれが発生（解析解が0のときPINNは非ゼロ値を予測）
- 初期条件と周期的な時刻では精度が高いが、中間時刻で誤差が大きい

### 4.2 Neumann BC - 8000エポック

![Neumann BC 8000](/home/manat/project3/PINN/experiments/neumann_bc_free_boundary_2026-01-07_12-36-29/solution_comparison.png)

**観察結果**:
- 初期時刻(t=0)では良好な一致
- 時間経過とともに誤差が増大（特にt=0.5で顕著）
- Neumannの自由境界条件の学習がDirichletより困難
- より深いネットワーク([2,64,64,64,64,1])でも精度向上が限定的

### 4.3 Standing Wave - 4000エポック

![Standing Wave 4000](/home/manat/project3/PINN/experiments/standing_wave_fundamental_mode_2026-01-07_12-39-04/solution_comparison.png)

**観察結果**:
- **最も優れた結果** (相対誤差5.44%)
- すべての時刻で解析解とよく一致
- 8000エポックより精度が高い（過学習の回避）

### 4.4 Standing Wave - 12000エポック

![Standing Wave 12000](/home/manat/project3/PINN/experiments/standing_wave_fundamental_mode_2026-01-07_12-39-34/solution_comparison.png)

**観察結果**:
- t=0.5で位相ずれが顕著（8000エポックと同様の傾向）
- 相対誤差8.36%（4000エポックより劣化）
- 訓練時間が長い(83秒)が精度向上せず

---

## 5. 重要な発見

### 5.1 エポック数の影響

| エポック数 | 相対誤差(%) | 訓練時間(秒) | 効率性 |
|-----------|-----------|------------|-------|
| 4000 | **5.44** | 27.85 | **最良** |
| 8000 | 7.56 | 53.48 | 普通 |
| 12000 | 8.36 | 83.27 | 悪い |

**結論**:
- **4000エポックが最適**（精度と計算コストのバランスが最良）
- 過剰な訓練は精度を低下させる（過学習の兆候）
- エポック数を増やしても必ずしも精度向上しない

### 5.2 境界条件の影響

| 境界条件 | 相対誤差(%) | ネットワーク複雑度 | 学習難易度 |
|---------|-----------|----------------|-----------|
| Dirichlet | 7.56 | 低 ([2,50,50,50,1]) | 低 |
| Neumann | 10.69 | 高 ([2,64,64,64,64,1]) | **高** |

**結論**:
- Neumann境界条件の学習がより困難
- より深いネットワークでも精度向上が限定的
- 初期条件の損失ウェイトを500に設定しても精度不十分

### 5.3 損失ウェイトの影響

#### Dirichlet BC (Standing Wave)
- BC重み: 10.0, IC重み: 10.0
- 境界条件と初期条件を強調
- 相対的に良好な結果

#### Neumann BC
- BC重み: 5.0, IC重み: **500.0**
- 初期条件を大幅に重視
- それでも精度は低い（10.69%）

#### Traveling Wave
- PDE重み: 2.0（他より高い）
- 物理法則の厳密な満足を重視
- 検証は無効だが、損失は効果的に収束

---

## 6. 波動の伝播パターン

### Standing Wave (Dirichlet)
- 時刻t=0とt=1で同じパターン（周期性）
- t=0.5で理論上は振幅0だが、PINNは非ゼロ値を予測
- 位相情報の学習が不完全

### Neumann BC
- cos波形の自由端振動
- 時間経過とともに振幅の誤差が累積
- 時間依存性の学習が特に困難

### Traveling Wave
- ガウシアンパルスの伝播
- 検証は実施していないが、損失の収束は良好
- 有界領域での進行波は境界での反射の影響を受ける

---

## 7. 考察

### 7.1 精度に関する課題

**すべての実験で5%の精度基準を達成できなかった理由**:

1. **時間依存性の学習困難**
   - 空間的なパターンは比較的良く学習
   - 時間発展の正確な再現が困難

2. **損失ウェイトの最適化不足**
   - 現在の損失ウェイトは手動設定
   - 自動的な損失ウェイト調整が必要

3. **ネットワーク構造の限界**
   - 時間依存性を扱うための特殊なアーキテクチャ（LSTM、Attention等）が未使用

4. **サンプリング戦略**
   - 時空間のサンプリング点の分布が最適でない可能性

### 7.2 エポック数と過学習

**興味深い発見**:
- 12000エポック（8.36%）より4000エポック（5.44%）の方が精度が高い
- これは典型的な**過学習**の兆候

**推奨事項**:
- Early stoppingの実装
- 検証損失のモニタリング
- 4000-6000エポックを標準として使用

### 7.3 境界条件の種類

**Neumannの難しさ**:
- 微分条件（∂u/∂x = 0）はDirichlet条件（u = 0）より制約が弱い
- より多くのネットワーク層でも精度向上が限定的
- 損失ウェイトの大幅な調整（IC=500）でも不十分

**改善策**:
- Neumannに特化した損失関数の設計
- 境界での微分計算の精度向上
- Adaptive loss weightingの導入

---

## 8. 推奨事項

### 8.1 即座に実施可能な改善

1. **エポック数の最適化**
   - 4000-6000エポックを標準として使用
   - Early stoppingの実装

2. **損失ウェイトの自動調整**
   - Grid searchまたはBayesian optimizationの実施
   - Adaptive weightingアルゴリズムの実装

3. **サンプリング戦略の改善**
   - 時間方向により多くのサンプリング点
   - 特に中間時刻（t=0.25, 0.5, 0.75）の強化

### 8.2 中期的な改善

1. **ネットワークアーキテクチャの拡張**
   - 時間依存性を扱うための特殊層の導入
   - Residual connectionsの追加

2. **Neumannに特化した手法**
   - 境界条件の異なる定式化
   - Physics-informed attention mechanism

3. **ハイパーパラメータの体系的探索**
   - 学習率のスケジューリング
   - ネットワーク深さと幅の最適化

### 8.3 長期的な研究方向

1. **Transfer learning**
   - 単純な問題で事前学習
   - 複雑な境界条件への転移

2. **Ensemble methods**
   - 複数のPINNモデルの組み合わせ
   - 不確実性の定量化

3. **2D/3D問題への拡張**
   - 本実験の知見を高次元問題に応用

---

## 9. 結論

本実験により、1D波動方程式をPINNで解く際の重要な知見が得られました：

### 主要な発見

1. ✅ **最適エポック数**: 4000エポックが精度とコストのバランスで最良
2. ✅ **境界条件の難易度**: Neumann > Dirichlet
3. ✅ **過学習の存在**: エポック数を増やしても精度向上しない
4. ⚠️ **時間依存性の課題**: 中間時刻での精度が低い
5. ⚠️ **損失ウェイトの重要性**: 現在の設定では5%基準を達成できず

### ベストプラクティス

- **Standing Wave (Dirichlet BC)** + **4000エポック** の組み合わせが最も効果的
- 損失ウェイトの自動調整機構の導入が急務
- Neumannなどの複雑な境界条件には特別な対策が必要

### 今後の課題

- 5%精度基準の達成（現在の最良は5.44%）
- Neumann境界条件での精度向上
- 時間依存性の学習改善
- 損失ウェイトの体系的最適化

---

## 10. 参考資料

### 実験ファイルの場所

- **実験スクリプト**: `/home/manat/project3/PINN/notebooks/experiment_runner.py`
- **ノートブック**: `/home/manat/project3/PINN/notebooks/wave_1d_demo.ipynb`
- **結果ディレクトリ**: `/home/manat/project3/PINN/experiments/`

### 設定ファイル

- `standing_wave_example.yaml`
- `neumann_bc_example.yaml`
- `traveling_wave_example.yaml`

### 生成された画像

各実験の結果は対応する実験ディレクトリに以下の形式で保存されています：
- `solution_comparison.png` - 解析解とPINN予測の比較
- `training_curves.png` - 訓練損失の推移

---

**レポート作成日**: 2026年1月7日
**総実験時間**: 約5分（合計312秒）
**実施実験数**: 5実験
